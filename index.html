<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Reformas Pendientes de Armonizar</title>

<!-- Favicon -->
<link rel="icon" href="favicon.png" type="image/png">

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

<!-- DataTables -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 40px;
}

h2 {
    margin-bottom: 5px;
}

#ultima-actualizacion {
    margin-bottom: 20px;
    font-weight: bold;
}

table {
    width: 100%;
}
</style>
</head>

<body>

<h2>Reformas Pendientes de Armonizar</h2>
<div id="ultima-actualizacion"></div>

<table id="tabla" class="display">
    <thead>
        <tr>
            <th>No</th>
            <th>ORDENAMIENTO</th>
            <th>MATERIA REFORMA</th>
            <th>PUBLICACIÓN DOF</th>
            <th>PLAZO PARA ARMONIZAR</th>
            <th>FECHA LÍMITE</th>
            <th>VENCIMIENTO</th>
            <th>HECHO</th>
            <th>ENLACE</th>
        </tr>
    </thead>
</table>

<script>

// Función para calcular vencimiento automáticamente
function calcularVencimiento(fechaLimiteStr) {

    const partes = fechaLimiteStr.split("/");
    const fechaLimite = new Date(partes[2], partes[1] - 1, partes[0]);

    const hoy = new Date();
    hoy.setHours(0,0,0,0);
    fechaLimite.setHours(0,0,0,0);

    const diferencia = Math.floor((fechaLimite - hoy) / (1000 * 60 * 60 * 24));

    if (diferencia < 0) {
        return "VENCIDO";
    } else if (diferencia === 0) {
        return "VENCE HOY";
    } else {
        return "FALTAN " + diferencia + " DÍAS";
    }
}

$(document).ready(function() {

    $('#tabla').DataTable({
        ajax: {
            url: 'datos.csv',
            dataSrc: function(data) {
                const lines = data.split('\n');
                const headers = lines[0].split(',');
                const resultado = [];

                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === "") continue;

                    const valores = lines[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                    const fila = {};

                    headers.forEach((header, index) => {
                        fila[header.trim()] = valores[index] ? valores[index].replace(/"/g, "") : "";
                    });

                    resultado.push(fila);
                }

                return resultado;
            }
        },

        columns: [
            { data: "No" },
            { data: "ORDENAMIENTO" },
            { data: "MATERIA REFORMA" },
            { data: "PUBLICACIÓN DOF" },
            { data: "PLAZO PARA ARMONIZAR" },
            { data: "FECHA LÍMITE" },

            // COLUMNA DINÁMICA VENCIMIENTO
            {
                data: "FECHA LÍMITE",
                render: function(data, type, row) {
                    return calcularVencimiento(data);
                }
            },

            { data: "HECHO" },

            // Convertir ENLACE en botón
            {
                data: "ENLACE",
                render: function(data) {
                    return '<a href="' + data + '" target="_blank">Ver decreto</a>';
                }
            }
        ],

        language: {
            url: "https://cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json"
        }
    });

    // Última actualización automática
    const hoy = new Date();
    const fechaFormateada = hoy.toLocaleDateString('es-MX', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });

    document.getElementById("ultima-actualizacion").innerText =
        "Última actualización: " + fechaFormateada;
});
</script>

</body>
</html>
